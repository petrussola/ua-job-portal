---
import OpeningsList from "../../components/OpeningsList.astro";
import { fetchOpenings } from "../../helpers/fetch-data.astro";
import { sanitiseString } from "../../helpers/sanitise-string.astro";
import BaseLayout from "../../layouts/BaseLayout.astro";

export async function getStaticPaths() {
  const allOpenings = await fetchOpenings();

  const uniqueCompanies = [
    ...new Set(
      allOpenings.map((opening) => {
        const sanitisedCompanyName = sanitiseString(
          opening.frontmatter.company,
        );

        return sanitisedCompanyName;
      }),
    ),
  ];

  return uniqueCompanies.map((company) => {
    const filteredOpenings = allOpenings.filter(
      (opening) => sanitiseString(opening.frontmatter.company) === company,
    );

    return {
      params: { company },
      props: { openings: filteredOpenings },
    };
  });
}

const { company } = Astro.params;
const { openings } = Astro.props;

const capitalisedCompany = company[0]?.toUpperCase() + company.slice(1);
---

<BaseLayout pageTitle={capitalisedCompany} shouldDisplayBack>
  <p>Openings in {capitalisedCompany}</p>

  <OpeningsList openingsList={openings} />
</BaseLayout>
